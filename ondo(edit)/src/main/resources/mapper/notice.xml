<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : 해당 mapper를 사용하는 DAO 정보 입력 -->
<mapper namespace="com.example.demo.notice.NoticeDAO">

    <resultMap type="com.example.demo.notice.NoticeVO" id="noticeMap">
        <result property="rowNum"       column="RN" />
        <result property="seq"          column="SEQ" />
        <result property="userId"       column="USERID" />
        <result property="title"        column="TITLE" />
        <result property="content"      column="CONTENT" />
        <result property="writer"       column="WRITER" />
        <result property="wrdate"       column="WRDATE" />
        <result property="divi"         column="DIVI" />
        <result property="views"        column="VIEWS" />
    </resultMap>

    <select id="selectNoticeRowCount" resultType="integer">
        SELECT COUNT(*) FROM NOTICE_TBL
    </select>

    <select id="selectNoticeList" resultMap="noticeMap">
        SELECT * FROM (SELECT rowNum RN, NOTICE_TBL.* FROM NOTICE_TBL)
        WHERE RN <![CDATA[>=]]> (#{page} * #{rowsPerPage}) + 1 AND
              RN <![CDATA[<=]]> (#{page} + 1) * #{rowsPerPage}
    </select>

    <insert id="insertNoticeContent">
        INSERT INTO NOTICE_TBL(USERID, SEQ, TITLE, CONTENT, WRITER, WRDATE, DIVI, VIEWS) VALUES
        (#{userId}, (SELECT NVL(MAX(SEQ), 0)+1 AS SEQ FROM NOTICE_TBL WHERE USERID=#{userId}), #{title}, #{content}, #{writer}, SYSDATE, #{divi}, #{views})
    </insert>

    <select id="selectNoticeContent" resultMap="noticeMap">
        SELECT * FROM NOTICE_TBL WHERE USERID=#{userId} AND SEQ=#{seq}
    </select>

    <update id="updateNoticeContent">
        UPDATE NOTICE_TBL SET TITLE=#{title}, CONTENT=#{content} WHERE USERID=#{userId} AND SEQ=#{seq}
    </update>

    <delete id="deleteNoticeContent">
        DELETE FROM NOTICE_TBL WHERE USERID=#{userId} AND SEQ=#{seq}
    </delete>

    <update id="updateViewCount">
        UPDATE NOTICE_TBL SET VIEWS = (VIEWS + 1) WHERE SEQ=#{seq}
    </update>

    <select id="selectViewCount" resultMap="noticeMap">
        SELECT * FROM NOTICE_TBL WHERE SEQ=#{seq}
    </select>


</mapper>